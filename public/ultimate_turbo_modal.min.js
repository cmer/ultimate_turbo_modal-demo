import{Controller as t}from"@hotwired/stimulus";import{Turbo as e}from"@hotwired/turbo-rails";import{enter as o,leave as d}from"el-transition";class i extends t{static targets=["modal","overlay","container","innerModal"];static values={advanceUrl:String};connect(){let t=this;this.showModal(),this.turboFrame=this.element.closest("turbo-frame"),window.addEventListener("popstate",(function(e){t.#t()&&t.#e()})),window.modal=this}disconnect(){window.modal=void 0}showModal(){o(this.containerTarget),this.#o(),this.advanceUrlValue&&!this.#t()&&(this.#d(),history.pushState({},"",this.advanceUrlValue))}hideModal(){if(this.hidingModal)return;this.hidingModal=!0;let t=new Event("modal:closing",{cancelable:!0});this.turboFrame.dispatchEvent(t),t.defaultPrevented||(this.#e(),this.#i(),t=new Event("modal:closed",{cancelable:!1}),this.turboFrame.dispatchEvent(t),this.#t()&&history.back())}hide(){this.hideModal()}submitEnd(t){t.detail.success&&this.hideModal()}closeWithKeyboard(t){"Escape"==t.code&&this.hideModal()}outsideModalClicked(t){t.target!=this.overlayTarget&&t.target!=this.innerModalTarget||this.hideModal()}#e(){d(this.containerTarget).then((()=>{this.turboFrame.removeAttribute("src"),this.containerTarget.remove(),this.#a()}))}#t(){return"true"==document.body.getAttribute("data-turbo-modal-history-advanced")}#d(){return document.body.setAttribute("data-turbo-modal-history-advanced","true")}#a(){document.body.removeAttribute("data-turbo-modal-history-advanced")}#o(){document.body.style.overflow="hidden"}#i(){document.body.style.overflow="auto"}}function a(t){t.register("modal",i),Turbo.StreamActions.modal=function(){const t=this.getAttribute("message");"hide"==t&&window.modal?.hide(),"close"==t&&window.modal?.hide()},document.addEventListener("turbo:frame-missing",(function(t){t.detail.response.redirected&&t.target==document.querySelector("turbo-frame#modal")&&(t.preventDefault(),t.detail.visit(t.detail.response))}))}e.StreamActions.modal=function(){const t=this.getAttribute("message");"hide"==t&&window.modal?.hide(),"close"==t&&window.modal?.hide()};export{a as default};
